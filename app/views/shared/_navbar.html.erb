<!-- DESKTOP -->
<div class="container d-none d-lg-block backdrop" style="position: sticky; top: 0; z-index: 1;">
  <div class="d-flex justify-content-between align-items-center" style="height: 80px;">
    <%= link_to "/", class: "me-auto" do %>
      <%= image_tag("logo.svg", style: 'height: 35px;', class: 'icon') %>
    <% end %>
    <%= link_to "L'authentification", authentication_path, class: "navbar__auth-button" %>
    <%= form_with url: sneakers_path, method: :get do |f| %>
      <div style="position: relative;">
        <%= f.text_field :search, class: "form-control", style: "width: 320px", placeholder: "Essaye Nike, Air Jordan..." %>
        <%= image_tag "images/lens.svg", style: "position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); cursor: pointer", onclick: "this.closest('form').submit()" %>
      </div>
    <% end %>
    <%= button_to "Vendre", sneakers_path, class: "navbar__sell-button" %>
    <%= image_tag "navbar/toggler_icon.svg", class: "toggler_icon navbarSideButton", style: "cursor: pointer; height: 35px;" %>
  </div>
</div>

<!-- MOBILE -->
<div class="container d-lg-none backdrop" style="position: sticky; top: 0; z-index: 1;">
  <div class="d-flex justify-content-between align-items-center" style="width: 100%; height: 80px;">
    <div class="navbar-burger">
    <%= image_tag "navbar/toggler_icon.svg", class: "toggler_icon navbarSideButton", style: "cursor: pointer; height: 30px;" %>
    </div>
    <%= link_to "/", class: "navbar-logo-link" do %>
      <%= image_tag("logo.svg", style: 'height: 32px;', class: 'icon') %>
    <% end %>
    <%= form_with url: sneakers_path, html: { id: "navbar-search-form" }, method: :get do |f| %>
      <div style="position: relative;">
        <%= f.text_field :search, class: "navbar-search-input form-control", placeholder: "Essaye Nike, Air Jordan..." %>
        <%= image_tag "images/lens.svg", style: "height: 20px; position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); cursor: pointer", onclick: "handleLensClick()" %>
      </div>
    <% end %>
    <div class="navbar-close-icon" style="display: none; line-height: 0; font-size: 40px;" onclick="hideInput()">&times;</div>
  </div>
  <% if current_page?('/sneakers') %>
    <div class="d-flex align-items-center d-block d-lg-none mb-4">
      <div class="popup-close-icon me-auto" style="display: none; font-size: 35px; line-height: 0;" onclick="hidePopup()">&times;</div>
      <!-- FILTERS MOBILE -->
      <div class="filter-btn" style="cursor: pointer; width: 50%; padding: 0.5rem; border: 1px solid #0E0E0E; border-right: none; text-align: center;" onclick="revealPopup('filter')">Filtrer</div>
      <div class="sort-btn" style="cursor: pointer; width: 50%; padding: 0.5rem; border: 1px solid #0E0E0E; text-align: center;" onclick="revealPopup('sort')">Trier</div>
    </div>
    <div class="popup sort-popup">
      <%= form_with url: sneakers_path, local: false, method: :get, html: {id: "sort-form-mobile"} do |f| %>
        <div class="form-group" style="border: 1px solid #0E0E0E; padding: 1rem;">
          <div class="form-check mb-1">
            <%= f.radio_button :sort_by, "price_cents ASC", { class: "form-check-input" } %>
            <%= f.label "Prix croissant", class: "form-check-label" %>
          </div>
        </div>
        <div class="form-group" style="border: 1px solid #0E0E0E; padding: 1rem;">
          <div class="form-check mb-1">
            <%= f.radio_button :sort_by, "price_cents DESC", { class: "form-check-input" } %>
            <%= f.label "Prix décroissant", class: "form-check-label" %>
          </div>
        </div>
        <div class="form-group" style="border: 1px solid #0E0E0E; padding: 1rem;">
          <div class="form-check mb-1">
            <%= f.radio_button :sort_by, "created_at DESC", { class: "form-check-input", checked: true } %>
            <%= f.label "Du plus récent au plus ancien", class: "form-check-label" %>
          </div>
        </div>
        <div class="form-group" style="border: 1px solid #0E0E0E; padding: 1rem;"> 
          <div class="form-check mb-1">
            <%= f.radio_button :sort_by, "created_at ASC", { class: "form-check-input" } %>
            <%= f.label "Du plus ancien au plus récent", class: "form-check-label" %>
          </div>
        </div>
      <% end %>
    </div>
    <div class="popup filter-popup">
      <%= form_with url: sneakers_path, local: false, method: :get do |f| %>
        <div id="accordion">
          <div class="card">
            <div class="card-header" id="headingOne">
              <h5 class="mb-0">
                <a class="filter-title" data-bs-toggle="collapse" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  Marques
                </a>
              </h5>
            </div>
            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-bs-parent="#accordion">
              <div class="card-body">
                <div class="form-check mb-1">
                  <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Nike", nil %>
                  <%= f.label "Nike", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Jordan", nil %>
                  <%= f.label "Jordan", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Adidas", nil %>
                  <%= f.label "Adidas", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Yeezy", nil %>
                  <%= f.label "Yeezy", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "New Balance", nil %>
                  <%= f.label "New Balance", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Asics", nil %>
                  <%= f.label "Asics", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Autres", nil %>
                  <%= f.label "Autres", class: "form-check-label" %>
                </div>      
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="headingTwo">
              <h5 class="mb-0">
                <a class="filter-title collapsed" data-bs-toggle="collapse" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  Prix
                </a>
              </h5>
            </div>
            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-bs-parent="#accordion">
              <div class="card-body">
                <div class="row g-2">
                  <div class="col-5">
                    <%= f.number_field :min_price, min: 0, class: "form-control", placeholder: "Min" %>
                  </div>
                  <div class="col-5">
                    <%= f.number_field :max_price, class: "form-control", placeholder: "Max" %>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="headingThree">
              <h5 class="mb-0">
                <a class="filter-title collapsed" data-bs-toggle="collapse" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                  Condition
                </a>
              </h5>
            </div>
            <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-bs-parent="#accordion">
              <div class="card-body">
                <div class="form-check mb-1">
                  <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "6", nil %>
                  <%= f.label "6/10 ou moins", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "7", nil %>
                  <%= f.label "7/10", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "8", nil %>
                  <%= f.label "8/10", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "9", nil %>
                  <%= f.label "9/10", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "10", nil %>
                  <%= f.label "10/10", class: "form-check-label" %>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="headingThree">
              <h5 class="mb-0">
                <a class="filter-title collapsed" data-bs-toggle="collapse" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                  Taille
                </a>
              </h5>
            </div>
            <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-bs-parent="#accordion">
              <div class="card-body">
                <div class="form-check mb-1">
                  <%= f.check_box :size, { multiple: true, class: "form-check-input" }, "6", nil %>
                  <%= f.label "6", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :size, { multiple: true, class: "form-check-input" }, "7", nil %>
                  <%= f.label "7", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :size, { multiple: true, class: "form-check-input" }, "8", nil %>
                  <%= f.label "8", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :size, { multiple: true, class: "form-check-input" }, "9", nil %>
                  <%= f.label "9", class: "form-check-label" %>
                </div>
                <div class="form-check mb-1">
                  <%= f.check_box :size, { multiple: true, class: "form-check-input" }, "10", nil %>
                  <%= f.label "10", class: "form-check-label" %>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button class="filter-popup-update-btn" type="submit" onclick="hidePopup()">Mettre à jour</button>
      <% end %>
    </div>
  <% end %>
</div>

<% if current_page?('/') %>
  <div style="background-color: #EFEFEF" data-flickity='{ "draggable": false, "pageDots": false, "prevNextButtons": false, "autoPlay": true, "wrapAround": true, "cellSelector": ".banner-link" }'>
    <div class="banner-link w-100 text-center py-3">
      <%= link_to sneakers_path(max_price: 200) do %>
        🤙 Découvrez notre sélection à moins de 200€
      <% end %>
    </div>
    <div class="banner-link w-100 text-center py-3">
      <%= link_to sneakers_path, method: :post do %>
        🤙 Frais d’authentification offerts sur la première vente
      <% end %>
    </div>
  </div>
<% end %>

<div class="navbar-side" id="navbarSide">
  <div class="navbar-side__menu d-flex flex-column align-items-end" style="gap: 0.8rem; height: 100%; padding: 2rem 1rem; color: white;">
    <div class="navbar-side__menu__close" style="cursor: pointer; font-size: 30px; line-height: 1;">
      &times;
    </div>
    <div class="navbar-side__menu__item">
      <%= link_to "Mon compte", user_path %>
    </div>
    <div class="navbar-side__menu__item">
      <%= link_to "Vendre", sneakers_path, method: :post %>
    </div>
    <div class="navbar-side__menu__item">
      <%= link_to "Tout voir", sneakers_path %>
    </div>
    <div class="navbar-side__menu__item"> 
      <%= link_to "Nous contacter", new_contact_path %>
    </div>
    <div class="navbar-side__menu__item">
      <%= link_to "L'authentification", authentication_path %>
    </div>
    <div class="navbar-side__menu__item">
      <a href="https://www.instagram.com/rockdontstock/" target="_blank">
        <i class="fab fa-instagram"></i>
      </a>
    </div>
    <div class="navbar-side__login mt-auto align-self-center">
      <% if user_signed_in? %>
        <%= link_to "Me déconnecter", destroy_user_session_path, method: :delete %>
      <% else %>
        <%= link_to "Me connecter", user_session_path %>
      <% end %>
    </div>
  </div>
</div>
<ul class="navbar-side d-none" id="navbarSide">
  <div class="navbar-side-white-toggler">
    <% if user_signed_in? %>
    <div class="d-flex justify-content-center toggler_icon navbarSideButton" style="cursor: pointer; gap: 0.6rem; align-items: center; margin-left: 1rem">
      <%= image_tag("images/icon_avatar.svg", style: "height: 50px; width: auto; fill: #FFFFFF") %>
      <div style="line-height: 1">
        <div>Salut</div>
        <span style="font-weight: 700"><%= current_user.first_name %></span> !
      </div>
    </div>
    <% else %>
      <%= image_tag "navbar/white/white_toggler_icon.svg" %>
    <% end %>
  </div>
</ul>

<div class="overlay"></div>

<script type="text/javascript">
  function handleLensClick() {
    let form = document.getElementById('navbar-search-form')

    if (form.status == "inputVisible") form.submit()
    else {
      form.style.width = "100%"

      document.querySelector('.navbar-logo-link').style.display = "none"
      document.querySelector('.navbar-burger').style.display = "none"
      document.querySelector('.navbar-close-icon').style.display = "block"

      document.querySelector('.navbar-search-input').style.border = "1px solid #0E0E0E"
      document.querySelector('.navbar-search-input').style.visibility = "visible"

      form.status = "inputVisible"
    }
  }

  function hideInput() {
    let form = document.getElementById('navbar-search-form')

    document.querySelector('.navbar-search-input').style.border = "none"
    document.querySelector('.navbar-search-input').style.visibility = "hidden"

    document.querySelector('.navbar-close-icon').style.display = "none"
    document.querySelector('.navbar-burger').style.display = "block"
    document.querySelector('.navbar-logo-link').style.display = "block"
    form.style.width = "0"
    form.status = ""
  }
  
  $(document).ready(function() {

    $('.navbarSideButton').on('click', function() {
      $('#navbarSide').addClass('reveal');
      $('.overlay').show();
    });

    $('.overlay, .navbar-side-item>a, .navbar-side-white-toggler, .navbar-side__menu__close').on('click', function(){
      $('#navbarSide').removeClass('reveal');
      $('.overlay').hide();
    });

    $('#navbar-side-see-all').on('click', function() {
      $('#navbarSide').removeClass('reveal');
      $('.overlay').hide();
      if ($( window ).width() >= 1024) {
        $('.glass_icon').hide();
        $('.glass-search-form').show();
      } else {
        $('.toggler_icon_phone').hide();
        $('.glass-search-form').show();
        $('.magnify_glass_icon_phone').hide();
        $('.real-nav').css('justify-content', 'center');
        $('.dropdown-filter-items').hide();
      }
    });

    $('.glass_icon_phone').on('click', function() {
      $('.toggler_icon_phone').hide();
      $('.glass-search-form').show();
      $('.magnify_glass_icon_phone').hide();
      $('.real-nav').css('justify-content', 'center');
      $('.dropdown-filter-items').hide();
    });

      // $('.glass-search-form').show();
    // $('.dropdown-filter-items').show();

    $('.glass_icon').on('click', function() {
      $('.glass_icon').hide();
      $('.glass-search-form').show();
    });

    if ($( window ).width() < 1024) {
      $('.dropdown-filter').on('click', function() {
        $('.dropdown-filter-items').slideToggle('fast');
        $('.dropdown-filter-laptop').hide();
      });
    } else {
      $('.dropdown-filter').hide();
    }

    $('.hide-search-arrow').on('click', function () {
      $('.glass-search-form').hide();
      $('toggler_icon, .glass_icon, #sell_button').show();
    })

    $('.phone-hide-search-arrow').on('click', function () {
      $('.glass-search-form').hide();
      $('.real-nav').css('justify-content', 'space-between');
      $('img.toggler_icon_phone, .magnify_glass_icon_phone').show();
    })
  });
</script>

<style>
#navbar-search-form {
  width: 30px;
  transition: all 0.2s ease;
}
.navbar-search-input {
  visibility: hidden;
  border: none;
}
.navbar-close-icon {
  margin-left: 1rem;
  cursor: pointer;
}
.backdrop {
  background-color: rgba(255, 255, 255, .9);
}
@supports ((-webkit-backdrop-filter: blur(2em)) or (backdrop-filter: blur(2em))) {
  .backdrop {
    background-color: rgba(255, 255, 255, .5);
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
  }
}
</style>