<%= simple_form_for(sneaker.new_record? ? [sneaker_db, sneaker] : sneaker, id: 'newSneakerForm') do |f| %>
  <div class="info-input">
     <%= f.input :size, collection: [ ["1", 1], ["1.5", 1.5], ["2", 2], ["2.5", 2.5], ["3", 3], ["3.5", 3.5], ["4", 4], ["4.5", 4.5], 
        ["5", 5], ["5.5", 5.5], ["6", 6], ["6.5", 6.5], ["7", 7], ["7.5", 7.5], ["8", 8], ["8.5", 8.5], ["9", 9], ["9.5", 9.5],
        ["10", 10], ["10.5", 10.5], ["11", 11], ["11.5", 11.5], ["12",12], ["12.5", 12.5], ["13", 13], ["13.5", 13.5],
        ["14", 14], ["14.5", 14.5], ["15", 15], ["16", 16], ["17", 17], ["18", 18] ],required: true, prompt: "Taille US", 
        label: false, input_html: { class: "info-input-sneaker"} %>
    <%= f.error :size, :id => "sneaker_size_error" %>

  	<%= f.input :condition, prompt: "Condition", collection: [ ["5/10 et moins", 5], ["6/10", 6],["8/10", 8],["9/10",9],['10/10', 10] ], required: true, label: false,
      input_html: { class: "info-input-sneaker" },
      hint: "#{link_to "Tout savoir sur les conditions", faq_path, style:"color:#707981;", target: :_blank}".html_safe %>
    <%= f.error :condition, :id => "sneaker_condition_error" %>
  	
    <%= f.input :box, prompt: "Type de Box", collection: ["Og Box (Avec extras)", "Og Box (Sans extra)", "Boite de remplacement", "Pas de boite"], required: true, label: false, input_html: { class: "info-input-sneaker" }  %>
    <%= f.error :box, :id => "sneaker_box_error" %>

  	<%= f.input :extras, required: true, placeholder: "Commentaires", label: false,
    input_html: { class: "info-input-sneaker" }, 
    hint: "Transmets-nous ici les d√©fauts de ta paire <br>ou toute information utile pour l'acheteur <br>(trous, traces, extra en moins...)".html_safe %>
    <%= f.error :extras, :id => "sneaker_extras_error" %>


    <%= f.input :price, required: true, placeholder: "Prix", label: false,
    input_html: { class: "info-input-sneaker", value: nil} %>
    <%= f.error :price, :id => "sneaker_price_error" %>

    <div clas="total-price-for-seller">
      <p></p>
    </div>
  </div>

  <div class="next-btn">
    <input id="nextBtn" type="button" class="btn btn-dark" value="Suivant" >
  </div>
  

  <div class="photos-input">
    <p style="text-align:center">Attention : les photos que tu impl√©mentes doivent respecter l‚Äôordre pr√©sent√© ci-dessous. Dans le cas contraire, ton annonce ne sera pas valid√©e.</p>
    <div class='sneaker-photo-input'>
      <%= f.file_field :photos, as: :file, accept: "image/jpg, image/jpeg, image/png", #onchange:"resizePhotos()",
      id: 'photo-input0',
      class: 'hidden upload-photo photo-input0',
      label: 'üì∑ Ajoute une photo'%>
      <%= image_tag "", width: 0, class: "hidden", id: "photo-preview0" %>
      <%= f.label :photos, "Int√©rieur" %>
      <%= f.error :photos, :id => "sneaker_photo0_error" %>
    </div>
    <div class='sneaker-photo-input'>
      <%= f.file_field :photos, as: :file, accept: "image/jpg, image/jpeg, image/png", #onchange:"resizePhotos()",
      id: 'photo-input1',
      class: 'hidden upload-photo photo-input1',
      label: 'üì∑ Ajoute une photo' %>
      <%= image_tag "", width: 0, class: "hidden", id: "photo-preview1" %>
      <%= f.label :photos, "Ext√©rieur"  %>
      <%= f.error :photos, :id => "sneaker_photo1_error" %>
    </div>
    <div class='sneaker-photo-input'>
      <%= f.file_field :photos, as: :file, accept: "image/jpg, image/jpeg, image/png",#onchange:"resizePhotos()",
      id: 'photo-input2',
      class: 'hidden upload-photo photo-input2',
      label: 'üì∑ Ajoute une photo' %>
      <%= image_tag "", width: 0, class: "hidden", id: "photo-preview2" %>
      <%= f.label :photos, "Derri√®re"  %>
      <%= f.error :photos, :id => "sneaker_photo2_error" %>
    </div>
    <div class='sneaker-photo-input'>
      <%= f.file_field :photos, as: :file, accept: "image/jpg, image/jpeg, image/png", #onchange:"resizePhotos()",
      id: 'photo-input3',
      class: 'hidden upload-photo photo-input3',
      label: 'üì∑ Ajoute une photo' %>
      <%= image_tag "", width: 0, class: "hidden", id: "photo-preview3" %>
      <%= f.label :photos, "Dessus"  %>
      <%= f.error :photos, :id => "sneaker_photo3_error" %>
    </div>
    <div class='sneaker-photo-input'>
      <%= f.file_field :photos, as: :file, accept: "image/jpg, image/jpeg, image/png", #onchange:"resizePhotos()",
      id: 'photo-input4',
      class: 'hidden upload-photo photo-input4',
      label: 'üì∑ Ajoute une photo' %>
      <%= image_tag "", width: 0, class: "hidden", id: "photo-preview4" %>
      <%= f.label :photos, "Dessous"  %>
      <%= f.error :photos, :id => "sneaker_photo4_error" %>
    </div>
    <div class='sneaker-photo-input'>
      <%= f.file_field :photos, as: :file, accept: "image/jpg, image/jpeg, image/png", #onchange:"resizePhotos()",
      id: 'photo-input5',
      class: 'hidden upload-photo photo-input5',
      label: 'üì∑ Ajoute une photo' %>
      <%= image_tag "", width: 0, class: "hidden", id: "photo-preview5" %>
      <%= f.label :photos, "Size tag"  %>
      <%= f.error :photos, :id => "sneaker_photo5_error" %>
    </div>
    <div class='sneaker-photo-input'>
      <%= f.file_field :photos, as: :file, accept: "image/jpg, image/jpeg, image/png",
      id: 'photo-input6',
      class: 'hidden upload-photo photo-input6',
      label: 'üì∑ Ajoute une photo' %>
      <%= image_tag "", width: 0, class: "hidden", id: "photo-preview6" %>
      <%= f.label :photos, "Optionnel : Boite"  %>
    </div>
    <div class='sneaker-photo-input'>
      <%= f.file_field :photos, as: :file, accept: "image/jpg, image/jpeg, image/png",
      id: 'photo-input7',
      class: 'hidden upload-photo photo-input7',
      label: 'üì∑ Ajoute une photo' %>
      <%= image_tag "", width: 0, class: "hidden", id: "photo-preview7" %>
      <%= f.label :photos, "Optionnel : D√©faults sur la paire"  %>
    </div>
  </div>
  <div class="snd-next-btn">
    <button type="button" id="sndNextBtn" class="btn btn-dark" >Suivant</button>
  </div>



  <div class="summary-new-sneaker">
    <div class='summary-photo'>
      <div id="carouselSummaryNewSneaker" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active carousel-sneaker-photo0"></div>
          <div class="carousel-item carousel-sneaker-photo1"></div>
          <div class="carousel-item carousel-sneaker-photo2"></div>
          <div class="carousel-item carousel-sneaker-photo3"></div>
          <div class="carousel-item carousel-sneaker-photo4"></div>
          <div class="carousel-item  carousel-sneaker-photo5"></div>
        </div>
        <a class="carousel-control-prev" href="#carouselSummaryNewSneaker" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon sneaker-show-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselSummaryNewSneaker" role="button" data-slide="next">
          <span class="carousel-control-next-icon sneaker-show-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
      <div class="summary-new-sneaker-infos">
        <div class='summary-name'>
         <p>Mod√®le : <strong><%= @sneaker_db.name %></strong></p>
        </div>
        <div class='summary-size'></div>
        <div class='summary-cond'></div>
        <div class='summary-extras'></div>
        <div class='summary-box'></div>
      </div>
    </div>
    <div class="summary-new-sneaker-resume"> 
      <div class="summary-new-sneaker-price">
        <div class="summary-price-seller"></div>
        <div class="summary-price-check"></div>
        <div class="summary-price-shipping">
          <p class="summary-price-sneaker">Exp√©dition : <span id="summary-price-shipping">4.99‚Ç¨</span></p>
        </div>
        <hr>
        <div class="summary-price-total">   
        </div>
        <div><%= link_to("Tout savoir sur l'authentification", authentification_path, style:"color:#707981;", target: :_blank) %></div>
        <div class="submit-new-sneaker">
          <button disabled="true" name="button-new-sneaker" id="finishSneakerNewBtn" value="Finaliser la mise en vente" class="btn finish-sneaker-new-btn text-center btn btn-dark">Finaliser la mise en vente</button>
          <div style="display:none" id="finishSneakerNewWaitMessage">
            <i class='fas fa-spinner fa-spin'></i> Chargement <span id="waitTimer10s"></span> sec ...
          </div>
        </div>
      </div>
    </div>
  </div>

<% end %>


<style type="text/css">
  /*.info-input-sneaker:focus {
    outline:none;
    outline-width: 0;
  }*/
  .finish-sneaker-new-btn {
    font-size: 13px;
    padding: 5px 10px;
  }
  .next-btn, .snd-next-btn {
    text-align: center;
  }
  .snd-next-btn {
    float: right;
  }
  .next-btn {
    margin-top: 30px;
    margin-left: 173px;
  }
  .info-input-sneaker {
    width: 250px;
    margin: 10px 0;
  }
  .info-input {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .sneaker-photo-input {
    display: flex;
    text-align: center;
    flex-direction: column;
  }
  .submit-new-sneaker {
    text-align: center;
  }
  .upload-photo {
    width: 200px;
    height: 200px;
    background-position: center;
    background-repeat: no-repeat;
    background-size: contain;
  }
  .photo-input0 {
    background-image: url(/assets/sneaker_new/1.jpg);
  }
  .photo-input1 {
    background-image: url(/assets/sneaker_new/2.jpg);
  }
  .photo-input2 {
    background-image: url(/assets/sneaker_new/3.jpg);
  }
  .photo-input3 {
    background-image: url(/assets/sneaker_new/4.jpg);
  }
  .photo-input4 {
    background-image: url(/assets/sneaker_new/5.jpg);
  }
  .photo-input5 {
    background-image: url(/assets/sneaker_new/7.jpg);
  }
  .photo-input6 {
    background-image: url(/assets/sneaker_new/6.jpg);
  }
  .photo-input7 {
    background-image: url(/assets/sneaker_new/8.jpg);
  }
  
  .photos-input {
    display: flex;
    flex-wrap: wrap;
    flex-direction: row;
    align-items: center;
    justify-content: center;
  }

  .upload-photo {
    margin: 20px 20px;
  }
</style>
<style type="text/css">
  .search-sneaker-model {
    min-height: 100vh;
  }
  .sneaker_price, #sneaker_price, #sneaker_size{
    margin-bottom: 0;
  }
  
  #sneaker_price_error, #sneaker_extras_error, #sneaker_size_error, #sneaker_condition_error, #sneaker_box_error {
    margin-top: -17px;
    margin-bottom: 17px;
    width: 250px;
    visibility: hidden;
    color: #e74c3c;
  }
  #sneaker_photo0_error, #sneaker_photo1_error, #sneaker_photo2_error, #sneaker_photo3_error, #sneaker_photo4_error, #sneaker_photo5_error{
    color: #e74c3c; 
  }
  #sneaker_price_error {
    margin-top: 0px;
  }
  #sneaker_extras_error {
    margin-top: 0px;
  }
  @media (min-width: 320px) {
    .search-sneaker-model-title {
      font-size: 30px;
    }
    .summary-name>p, .summary-size>p, .summary-cond>p, .summary-extras>p, .summary-box>p {
      margin-bottom: 5px;
    }
    .summary-new-sneaker-infos {
      font-size: 12px;
      margin-bottom: 30px;
    }
    .summary-price-sneaker {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    .submit-new-sneaker {
      grid-column: 1 / 3;
      margin-top: 30px;
    }

  }
  @media (min-width: 768px) {
    .summary-new-sneaker-resume {
      font-size: 12px;
      width: 250px
    }
    .submit-new-sneaker {
      grid-column: 2 / 3;
    }
    .summary-new-sneaker {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      justify-items: center;
      align-items: center;
    }
  }
  @media (min-width: 1024px) {
    .summary-new-sneaker-resume {
      width: 400px
    }
  }
  @media (min-width: 1440px) {
    .summary-new-sneaker-resume {
      width: 500px
    }
  }

</style>




<style type="text/css">
  #summary-price-check {
    text-decoration: line-through;
  }
</style>


<!-- <script type="text/javascript">
  function fetchPhotos(opti_photos) {
  let data = new FormData($("form[id*='newSneakerForm']")[0]);
  data.append('sneaker[size]', document.getElementById('sneaker_size').value);
  data.append('sneaker[condition]', document.getElementById('sneaker_condition').value);
  data.append('sneaker[box]', document.getElementById('sneaker_box').value);
  data.append('sneaker[extras]', document.getElementById('sneaker_extras').value);
  data.append('sneaker[price]', document.getElementById('sneaker_price').value);
  opti_photos.forEach(elem => {
    data.append('sneaker[photos][]', elem);
  });
  // data.append('sneaker[photos][]', opti_photos);
  // if (opti_photos.length == 5) {
    console.log('going to fetch bitches !');
    fetch(document.getElementById('new_sneaker').action, {
      method: "POST",
      body: data,
    })
  }
// }

let opti_photos = [];

function resizePhotos () {
  console.log(opti_photos);
  // console.log('ok');
  // let file0 = document.getElementById('photo-input0').files[0];
  // let file1 = document.getElementById('photo-input1').files[0];
  // let file2 = document.getElementById('photo-input2').files[0];
  // let file3 = document.getElementById('photo-input3').files[0];
  // let file4 = document.getElementById('photo-input4').files[0];
  // let file5 = document.getElementById('photo-input5').files[0];
  // let file = [file0, file1, file2, file3, file4, file5];
  // let file6 = document.getElementById('photo-input6').files[0];
  // if (file6) {
  //   file.push(file6);
  // }
  // let file7 = document.getElementById('photo-input7').files[0];
  // if (file7) {
  //   file.push(file7);
  // }

  // for (let i = 0; i < file.length; i++) {
  // window.uploadPhotos = function(url) {
    var file = event.target.files[0];
    console.log(file)

    if (file.type.match('image/jpg') || file.type.match('image/jpeg') || file.type.match('image/png')) {
      // console.log('An image has been loaded');
      // Load the image
      var reader = new FileReader();
      reader.onload = function (readerEvent) {
        var image = new Image();
        image.onload = function (imageEvent) {
          // Resize the image
          console.log('image loaded !')
          var canvas = document.createElement('canvas'),
            max_size = 1000,// TODO : pull max size from a site config
            width = image.width,
            height = image.height;
            console.log('create canva')
          if (width > height) {
            if (width > max_size) {
              height *= max_size / width;
              width = max_size;
            }
          } else {
            if (height > max_size) {
              width *= max_size / height;
              height = max_size;
            }
          }
          canvas.width = width;
          canvas.height = height;
          canvas.getContext('2d').drawImage(image, 0, 0, width, height);
          var dataUrl = canvas.toDataURL('image/jpeg');
          var resizedImage = dataURLToBlob(dataUrl);
          console.log('go trigger event');
          $.event.trigger({
              type: "resizeImg",
              blob: resizedImage,
              url: dataUrl
          });
        }
        image.src = readerEvent.target.result;
      }
      reader.readAsDataURL(file);
    }
  // };


  var dataURLToBlob = function(dataURL) {
    var BASE64_MARKER = ';base64,';
    if (dataURL.indexOf(BASE64_MARKER) == -1) {
      var parts = dataURL.split(',');
      var contentType = parts[0].split(':')[1];
      var raw = parts[1];
      return new Blob([raw], {type: contentType});
    }
    var parts = dataURL.split(BASE64_MARKER);
    var contentType = parts[0].split(':')[1];
    var raw = window.atob(parts[1]);
    var rawLength = raw.length;
    var uInt8Array = new Uint8Array(rawLength);
    for (var i = 0; i < rawLength; ++i) {
      uInt8Array[i] = raw.charCodeAt(i);
    }
    return new Blob([uInt8Array], {type: contentType});
  }

  $(document).on("resizeImg", function (event) {
    event.preventDefault();
    console.log(event)
    console.log("Uploaded the photo and pushed to opti photos ");
    if (event.blob && event.url) {
      //prendre le dernier event.blob si possible 

      // console.log(event.blob)
      // fetchPhotos(event.blob)
      // opti_photos.push(event.blob);
    }
    // console.log(opti_photos.length);
    // console.log(opti_photos);
    // console.log(file.length);

    // if (opti_photos.length == file.length) {
    //   fetchPhotos(opti_photos);
    // }
  });
}



</script> -->