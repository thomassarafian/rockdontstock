<% brand = ["Adidas", "Air Jordan", "Nike", "New Balance", "Other Brands", "Luxury Brands", "Collections"] %>
<% price = [["Moins de 100€", 100], ["Moins de 200€", 200], ["Moins de 300€", 300], ["Plus de 300€", 301]] %>
<% condition = [["5/10 et moins", 5], ["6/10", 6], ["8/10", 8], ["9/10", 9], ["10/10", 10]] %>
<% size = [["1", 1], ["1.5", 1.5], ["2", 2], ["2.5", 2.5], ["3", 3], ["3.5", 3.5], ["4", 4], ["4.5", 4.5], ["5", 5],
                ["5.5", 5.5], ["6", 6], ["6.5", 6.5], ["7", 7], ["7.5", 7.5], ["8", 8], ["8.5", 8.5], ["9", 9], ["9.5", 9.5],
                ["10", 10], ["10.5", 10.5], ["11", 11], ["11.5", 11.5], ["12",12], ["12.5", 12.5], ["13", 13], ["13.5", 13.5],
                ["14", 14], ["14.5", 14.5], ["15", 15], ["16", 16], ["17", 17], ["18", 18]] %>
<!-- <div class="glass-search-form">
  <div class="search-filter">
    <div class="filters">
      <button class="dropdown-filter btn btn-dark" type="button">Filtres</button>
      <div class="filter-and-sneakers">
        <div class="dropdown-filter-items">
          <button class="dropdown-filter-laptop btn btn-dark" type="button">Filtres</button>
          <%= form_with url: sneakers_path, method: :get do |f| %>
            <%= f.select :category, brand, { include_blank: "Toute les marques" }, { class: "form-select", onchange: "this.form.submit();" } %>
            <%= f.select :price, price, { include_blank: "Tous les prix" }, {  class: "form-select", onchange: "this.form.submit();" } %>
            <%= f.select :condition, condition, { include_blank: "Toute condition" }, {  class: "form-select", onchange: "this.form.submit();" } %>
            <%= f.select :size, size, { include_blank: "Toute taille" }, {  class: "form-select", onchange: "this.form.submit();" } %>
          <% end %>
        </div>
        <div style="margin-top: 10vh">
          
        </div>
        
      </div>
    </div>
  </div>
</div> -->
<title>Recherche - Rock Don't Stock</title>
<div class="container">
  <div class="d-flex justify-content-evenly align-items-center d-block d-lg-none" style="height: 30px">
    <div class="popup-close-icon me-auto" style="display: none; font-size: 35px; line-height: 0;" onclick="hidePopup()">&times;</div>
    <div class="filter-btn text-center" style="cursor: pointer;" onclick="revealPopup('filter')">Filtrer</div>
    <div class="sort-btn text-center" style="cursor: pointer;" onclick="revealPopup('sort')">Trier</div>
  </div>
  <div class="popup sort-popup">
    <%= form_with url: sneakers_path, local: false, method: :get do |f| %>
      <div class="form-group" style="border: 1px solid #0E0E0E; padding: 1rem;">
        <div class="form-check mb-1">
          <%= f.check_box :category, { class: "form-check-input" }, "Nike", nil %>
          <%= f.label "Du plus ancien au plus récent", class: "form-check-label" %>
        </div>
      </div>
      <div class="form-group" style="border: 1px solid #0E0E0E; padding: 1rem;">
        <div class="form-check mb-1">
          <%= f.check_box :category, { class: "form-check-input" }, "Nike", nil %>
          <%= f.label "Prix croissant", class: "form-check-label" %>
        </div>
      </div>
      <div class="form-group" style="border: 1px solid #0E0E0E; padding: 1rem;">
        <div class="form-check mb-1">
          <%= f.check_box :price, { class: "form-check-input" }, "Nike", nil %>
          <%= f.label "Prix décroissant", class: "form-check-label" %>
        </div>
      </div>
    <% end %>
  </div>
  <div class="popup filter-popup">
    <%= form_with url: sneakers_path, local: false, method: :get do |f| %>
      <div class="form-group togglable-dropdowns" style="border: 1px solid #0E0E0E; padding: 1rem;">
        <%= f.label "", style: "font-weight: 700; width: 100%;" do %>
          <div class="d-flex align-items-center">
            <span>Marques</span>
            <i class="fas fa-angle-down ms-auto"></i>
          </div>
        <% end %>
        <div class="dropdown-fields" style="display: none; margin-top: 0.5rem;">
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Nike", nil %>
            <%= f.label "Nike", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Jordan", nil %>
            <%= f.label "Jordan", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Adidas", nil %>
            <%= f.label "Adidas", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Yeezy", nil %>
            <%= f.label "Yeezy", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "New Balance", nil %>
            <%= f.label "New Balance", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Asics", nil %>
            <%= f.label "Asics", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Autres", nil %>
            <%= f.label "Autres", class: "form-check-label" %>
          </div>
        </div>
      </div>
      <div class="form-group togglable-dropdowns" style="border: 1px solid #0E0E0E; padding: 1rem;">
        <%= f.label "", style: "font-weight: 700; width: 100%;" do %>
          <div class="d-flex align-items-center">
            <span>Prix</span>
            <i class="fas fa-angle-down ms-auto"></i>
          </div>
        <% end %>
        <div class="dropdown-fields" style="display: none; margin-top: 0.5rem;">
          <div class="row g-2">
            <div class="col-5">
              <%= f.number_field :min_price, min: 0, class: "form-control", placeholder: "Min" %>
            </div>
            <div class="col-5">
              <%= f.number_field :max_price, class: "form-control", placeholder: "Max" %>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group togglable-dropdowns" style="border: 1px solid #0E0E0E; padding: 1rem;">
        <%= f.label "", style: "font-weight: 700; width: 100%;" do %>
          <div class="d-flex align-items-center">
            <span>Condition</span>
            <i class="fas fa-angle-down ms-auto"></i>
          </div>
        <% end %>
        <div class="dropdown-fields" style="display: none; margin-top: 0.5rem;">
          <div class="form-check mb-1">
            <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "6", nil %>
            <%= f.label "6/10 ou moins", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "7", nil %>
            <%= f.label "7/10", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "8", nil %>
            <%= f.label "8/10", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "9", nil %>
            <%= f.label "9/10", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "10", nil %>
            <%= f.label "10/10", class: "form-check-label" %>
          </div>
        </div>
      </div>
      <div class="form-group togglable-dropdowns" style="border: 1px solid #0E0E0E; padding: 1rem;">
        <%= f.label "", style: "font-weight: 700; width: 100%;" do %>
          <div class="d-flex align-items-center">
            <span>Taille</span>
            <i class="fas fa-angle-down ms-auto"></i>
          </div>
        <% end %>
        <div class="dropdown-fields" style="display: none; margin-top: 0.5rem;">
          <%= f.select :size, size, { include_blank: "Toute taille" }, {  style: "display: block; color: #495057; border-radius: 0; border: 1px solid #0E0E0E; padding: 0.5rem; background: none;" } %>
        </div>
      </div>
      <button type="submit">Mettre à jour</button>
    <% end %>
  </div>
  <section class="sneaker-featured">
    <div class="sneaker-featured__subtitle">Parcourir nos</div>
    <h2>Sneakers</h2>
    <div class="sneaker-featured-block">
      <div class="sneaker-featured-block__title">Sélection du jour</div>
      <div class="sneaker-featured-block__content">
        <%= cl_image_tag(@selection_of_the_day.photos.first&.key, class: 'sneaker-featured-photo') %>
        <div class="sneaker-featured-details">
          <h2 class="sneaker-featured__name"><%= @selection_of_the_day.sneaker_db.name %></h2>
          <div class="sneaker-featured-details__options">
            <%= @selection_of_the_day.sneaker_db.category %> - Taille <%= @selection_of_the_day.size %> - Condition: <%= @selection_of_the_day.condition %>/10
          </div>
          <div class="sneaker-featured-details__price"><%= @selection_of_the_day.price %>€</div>
          <div>
            <button class="sneaker-featured-details__purchase">Acheter</button>
            <button class="sneaker-featured-details__discover">Découvrir le modèle</button>
          </div>
        </div>
      </div>
    </div>
  </section>
  <div style="font-size: 1.563rem; margin-bottom: 3rem">Toutes les sneakers</div>
  <div class="d-flex align-items-start justify-content-between">
    <div class="d-none d-lg-block" style="width: 20%; position: sticky; top: 100px;">
      <%= form_with url: sneakers_path, local: false, method: :get do |f| %>
        <div class="form-group">
          <%= f.label "Marques", class: "form-label", style: "font-weight: 700" %>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Nike", nil %>
            <%= f.label "Nike", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Jordan", nil %>
            <%= f.label "Jordan", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Adidas", nil %>
            <%= f.label "Adidas", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Yeezy", nil %>
            <%= f.label "Yeezy", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "New Balance", nil %>
            <%= f.label "New Balance", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Asics", nil %>
            <%= f.label "Asics", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :category, { multiple: true, class: "form-check-input" }, "Autres", nil %>
            <%= f.label "Autres", class: "form-check-label" %>
          </div>
        </div>
        <div class="form-group">
          <%= f.label "Prix", class: "form-label", style: "font-weight: 700" %>
          <div class="row g-2">
            <div class="col-5">
              <%= f.number_field :min_price, min: 0, class: "form-control", placeholder: "Min" %>
            </div>
            <div class="col-5">
              <%= f.number_field :max_price, class: "form-control", placeholder: "Max" %>
            </div>
          </div>
        </div>
        <div class="form-group">
          <%= f.label "Condition", class: "form-label", style: "font-weight: 700" %>
          <div class="form-check mb-1">
            <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "6", nil %>
            <%= f.label "6/10 ou moins", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "7", nil %>
            <%= f.label "7/10", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "8", nil %>
            <%= f.label "8/10", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "9", nil %>
            <%= f.label "9/10", class: "form-check-label" %>
          </div>
          <div class="form-check mb-1">
            <%= f.check_box :condition, { multiple: true, class: "form-check-input" }, "10", nil %>
            <%= f.label "10/10", class: "form-check-label" %>
          </div>
        </div>
        <div class="form-group">
          <%= f.label "Taille", class: "form-label", style: "font-weight: 700" %>
          <%= f.select :size, size, { include_blank: "Toute taille" }, {  style: "display: block; color: #495057; border-radius: 0; border: 1px solid #0E0E0E; padding: 0.5rem; background: none;" } %>
        </div>
        <button type="submit">Mettre à jour</button>
      <% end %>
    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center" style="width: 80%; gap: 2rem;">
      <%= render partial: 'sneakers/list_sneakers' %>
    </div>
  </div>
</div>

<script>
  function revealPopup(which) {
    if (which == "filter") {
      document.querySelector('.sort-btn').style.display = "none"
      document.querySelector('.filter-popup').style.display = "block"
    } else {
      document.querySelector('.filter-btn').style.display = "none"
      document.querySelector('.sort-popup').style.display = "block"
    }

    document.querySelector('.popup-close-icon').style.display = "block"
  }

  function hidePopup() {
    document.querySelector('.popup-close-icon').style.display = "none"
    document.querySelector('.filter-btn').style.display = "block"
    document.querySelector('.sort-btn').style.display = "block"
    document.querySelector('.filter-popup').style.display = "none"
    document.querySelector('.sort-popup').style.display = "none"
  }

  function toggleDropdown(el) {
    let content = el.querySelector('.dropdown-fields')
    if(content.style.display == 'none') content.style.display = 'block';
    else content.style.display = 'none';
  }

  document.querySelectorAll('.togglable-dropdowns').forEach(el => {
    el.addEventListener('click', function(e) {
      toggleDropdown(el);
    })
  })
</script>

<style>
.popup-close-icon {
  cursor: pointer;
  transition: margin 0.2s ease;
}
.popup {
  display: none;
  position: fixed;
  left: 0;
  height: calc(100vh - 80px - 30px);
  width: 100%;
  padding: 2rem 1rem;
  background: white;
}
.form-group {
  transition: height: 0.5s ease;
}
</style>